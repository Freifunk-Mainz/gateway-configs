<VirtualHost *:80>
        ServerName map.freifunk-mainz.de
        ServerAdmin webmaster@freifunk-mwu.de

	Redirect permanent / https://map.freifunk-mainz.de/
</VirtualHost>

<VirtualHost *:443>
	ServerName map.freifunk-mainz.de

	ServerAdmin webmaster@freifunk-mainz.de
	DocumentRoot /var/www/freifunk-mainz.de/map/build

	<Directory /var/www/freifunk-mainz.de/map/build>
		Options None
		DirectoryIndex index.html
		AllowOverride None
		Order allow,deny
		allow from all
	</Directory>

	<FilesMatch "\.(json)$">
    		Header set Cache-Control "no-cache, no-store, must-revalidate, max-age=0, proxy-revalidate, no-transform"
		Header set Expires "Fri, 20 Dec 2013 23:29:41 GMT"
	</FilesMatch>
	<IfModule mod_expires.c>
		ExpiresActive on
		ExpiresByType text/css                              "access plus 1 month"
		ExpiresByType application/javascript                "access plus 1 month"
		# Web Open Font Format (WOFF) 1.0		
		ExpiresByType application/font-woff                 "access plus 1 month"
		ExpiresByType application/x-font-woff               "access plus 1 month"
		ExpiresByType font/woff                             "access plus 1 month"
		# Media files
		ExpiresByType audio/ogg                             "access plus 1 month"
		ExpiresByType image/bmp                             "access plus 1 month"
		ExpiresByType image/gif                             "access plus 1 month"
		ExpiresByType image/jpeg                            "access plus 1 month"
		ExpiresByType image/png                             "access plus 1 month"
		ExpiresByType image/svg+xml                         "access plus 1 month"
		ExpiresByType image/webp                            "access plus 1 month"
		ExpiresByType video/mp4                             "access plus 1 month"
		ExpiresByType video/ogg                             "access plus 1 month"
		ExpiresByType video/webm                            "access plus 1 month"
	</IfModule>

	<IfModule mod_mime.c>
		AddType application/json                            json map topojson
		AddType application/javascript                      js
	</IfModule>
	<IfModule mod_filter.c>
		AddOutputFilterByType DEFLATE "application/json" \
					      "application/javascript" \
					      "text/css" \
					      "text/html"
	</IfModule>


	SSLEngine on
	SSLCertificateFile	/etc/apache2/ssl/certs/wildcard.freifunk-mainz.de_cert.pem
	SSLCertificateKeyFile	/etc/apache2/ssl/private/wildcard.freifunk-mainz.de_private.key
	SSLCertificateChainFile	/etc/apache2/ssl/certs/wildcard.freifunk-mainz.de_cert.pem

	Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains"

	<FilesMatch "\.(cgi|shtml|phtml|php)$">
			SSLOptions +StdEnvVars
	</FilesMatch>
	<Directory /usr/lib/cgi-bin>
			SSLOptions +StdEnvVars
	</Directory>

	BrowserMatch "MSIE [2-6]" \
			nokeepalive ssl-unclean-shutdown \
			downgrade-1.0 force-response-1.0
	# MSIE 7 and newer should be able to use keepalive
	BrowserMatch "MSIE [17-9]" ssl-unclean-shutdown
</VirtualHost>

# vim: syntax=apache ts=4 sw=4 sts=4 sr noet
