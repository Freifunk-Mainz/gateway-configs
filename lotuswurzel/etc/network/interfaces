# This file describes the network interfaces available on your system
# and how to activate them. For more information, see interfaces(5).

# The loopback network interface
auto lo
iface lo inet loopback

# The primary network interface
auto eth0
iface eth0 inet static
	address 176.9.204.70
	netmask 255.255.255.255
	gateway 176.9.64.143
	pointopoint 176.9.64.143
	dns-nameservers 213.73.91.35

iface eth0 inet6 static
	address 2a01:4f8:150:8570::2
	netmask 64
	gateway 2a01:4f8:150:8570::1

# hurricane electric 6in4 tunnel
#auto he-ipv6
#iface he-ipv6 inet6 v4tunnel
#        address 2001:470:1f0a:f3d::2
#        netmask 64
#        endpoint 216.66.80.30
#        local 176.9.204.70
#        ttl 255

auto mzBR
iface mzBR inet static
	bridge-ports none
	address 10.37.0.23
	netmask 255.255.192.0
	# ip rules to add all traffic entering the bridge to the appropriate rt_table
	post-up		/sbin/ip rule add iif $IFACE table mz 
	pre-down	/sbin/ip rule del iif $IFACE table mz
	# local reachable subnet
	post-up		/sbin/ip route add 10.37.0.0/18 dev $IFACE table mz
	post-down	/sbin/ip route del 10.37.0.0/18 dev $IFACE table mz
	# insert ic-vpn light route for mz network into rt_table wi
	post-up		/sbin/ip route add 10.37.0.0/18 table wi src 10.37.0.23 dev $IFACE
	post-down	/sbin/ip route del 10.37.0.0/18 table wi src 10.37.0.23 dev $IFACE

iface mzBR inet6 static
	address fd37:b4dc:4b1e::a25:17
	netmask 64
	# ip rules to add all traffic entering the bridge to the appropriate rt_table
        post-up         /sbin/ip -6 rule add iif $IFACE table mz
        pre-down        /sbin/ip -6 rule del iif $IFACE table mz
	# link-local subnet
	post-up		/sbin/ip -6 route add fe80::/64 dev $IFACE table mz proto kernel metric 256
	post-down       /sbin/ip -6 route del fe80::/64 dev $IFACE table mz proto kernel metric 256
	# insert ic-vpn light route for mz network into rt_table wi
	post-up		/sbin/ip -6 route add fd37:b4dc:4b1e::/64 table wi src fd37:b4dc:4b1e::a25:17 dev $IFACE
	post-down	/sbin/ip -6 route del fd37:b4dc:4b1e::/64 table wi src fd37:b4dc:4b1e::a25:17 dev $IFACE

auto wiBR
iface wiBR inet static
        bridge-ports none
        address 10.56.0.23
        netmask 255.255.192.0
	# ip rules to add all traffic entering the bridge to the appropriate rt_table
        post-up         /sbin/ip rule add iif $IFACE table wi
        pre-down        /sbin/ip rule del iif $IFACE table wi
        # local reachable subnet
        post-up         /sbin/ip route add 10.56.0.0/18 dev $IFACE table wi
        post-down       /sbin/ip route del 10.56.0.0/18 dev $IFACE table wi
	# insert ic-vpn light route for wi network into rt_table mz
	post-up		/sbin/ip route add 10.56.0.0/18 table mz src 10.56.0.23 dev $IFACE
	post-down	/sbin/ip route del 10.56.0.0/18 table mz src 10.56.0.23 dev $IFACE

iface wiBR inet6 static
        address fd56:b4dc:4b1e::a38:17
        netmask 64
	# ip rules to add all traffic entering the bridge to the appropriate rt_table
        post-up         /sbin/ip -6 rule add iif $IFACE table wi
        pre-down        /sbin/ip -6 rule del iif $IFACE table wi
	# link-local subnet
        post-up         /sbin/ip -6 route add fe80::/64 dev $IFACE table wi proto kernel metric 256
        post-down       /sbin/ip -6 route del fe80::/64 dev $IFACE table wi proto kernel metric 256
	# insert ic-vpn light route for wi network into rt_table mz
        post-up         /sbin/ip -6 route add fd56:b4dc:4b1e::/64 table mz src fd56:b4dc:4b1e::a38:17 dev $IFACE
        post-down       /sbin/ip -6 route del fd56:b4dc:4b1e::/64 table mz src fd56:b4dc:4b1e::a38:17 dev $IFACE

allow-hotplug mzVPN
iface mzVPN inet6 manual
	pre-up		/sbin/modprobe batman_adv
        pre-up		/sbin/ip link set address 02:00:0a:25:00:17 dev $IFACE 
        post-up		/usr/sbin/batctl -m mzBAT if add $IFACE 
        post-up		/sbin/ip link set dev mzBAT up

allow-hotplug wiVPN
iface wiVPN inet6 manual
	pre-up		/sbin/modprobe batman_adv
        pre-up		/sbin/ip link set address 02:00:0a:38:00:17 dev $IFACE
        post-up		/usr/sbin/batctl -m wiBAT if add $IFACE
        post-up		/sbin/ip link set dev wiBAT up

allow-hotplug mzBAT
iface mzBAT inet6 manual
	pre-up		/sbin/modprobe batman-adv
	post-up		/sbin/brctl addif mzBR $IFACE
	post-up 	/usr/sbin/batctl -m $IFACE it 10000
	post-up 	/usr/sbin/batctl -m $IFACE vm server
	post-up 	/usr/sbin/batctl -m $IFACE gw server 96mbit/96mbit
	pre-down	/sbin/brctl delif mzBR $IFACE || true

allow-hotplug wiBAT
iface wiBAT inet6 manual
        pre-up          /sbin/modprobe batman-adv
        post-up         /sbin/brctl addif wiBR $IFACE
	post-up 	/usr/sbin/batctl -m $IFACE it 10000
	post-up 	/usr/sbin/batctl -m $IFACE vm server
	post-up 	/usr/sbin/batctl -m $IFACE gw server  96mbit/96mbit
        pre-down        /sbin/brctl delif wiBR $IFACE || true

